<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="alternate"
      type="application/rss+xml"
      href="https://keke-cute.github.io/rss.xml"
      title="RSS feed for https://keke-cute.github.io/">
<title>Gnupg Usage</title>
<meta name="author" content="keke">
<meta name="referrer" content="no-referrer">
<link href= "static/blog.css" rel="stylesheet" type="text/css" />
<link rel="icon" href="static/favicon.ico"></head>
<body>
<div id="preamble" class="status"><div class="header">
  <a href="https://keke-cute.github.io">Ethereal Horizon</a> <A href="https://keke-cute.github.io/emacs.html">Emacs Configure</a>
</div></div>
<div id="content">
<div class="post-date">21 Mar 2021</div><h1 class="post-title"><a href="https://keke-cute.github.io/2021-03-21-gnupg-usage.html">Gnupg Usage</a></h1>

<div id="outline-container-orga8a42e4" class="outline-2">
<h2 id="orga8a42e4"><span class="todo TODO">TODO</span> Generate GPG Key</h2>
<div class="outline-text-2" id="text-orga8a42e4">
</div>
<div id="outline-container-orgb56bf66" class="outline-3">
<h3 id="orgb56bf66">Make WorkSpace</h3>
<div class="outline-text-3" id="text-orgb56bf66">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;"># </span><span style="color: #758A99; font-style: italic; text-decoration: underline;">make temp dir</span>
<span style="color: #705438; background-color: #E3EFD1; font-style: italic;">export</span> <span style="color: #B35C44;">GNUPGHOME</span>=$<span style="color: #ff8c00; font-weight: bold;">(</span>mktemp -d<span style="color: #ff8c00; font-weight: bold;">)</span>
<span style="color: #705438; background-color: #E3EFD1; font-style: italic;">cd</span> $<span style="color: #B35C44;">GNUPGHOME</span>
<span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;"># </span><span style="color: #758A99; font-style: italic; text-decoration: underline;">get gpg.conf</span>
curl -O <span style="color: #177CB0;">"https://raw.githubusercontent.com/drduh/config/master/gpg.conf"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org36c0147" class="outline-3">
<h3 id="org36c0147">Generate-key</h3>
<div class="outline-text-3" id="text-org36c0147">
<div class="org-src-container">
<pre class="src src-shell">gpg --expert --full-generate-key
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd9cb5eb" class="outline-2">
<h2 id="orgd9cb5eb">OpenGPG Smart Card</h2>
<div class="outline-text-2" id="text-orgd9cb5eb">
</div>
<div id="outline-container-org56b9b76" class="outline-3">
<h3 id="org56b9b76"><span class="todo TODO">TODO</span> Yubikey</h3>
</div>
<div id="outline-container-org1bf83d5" class="outline-3">
<h3 id="org1bf83d5">Make Gnuk Card(only need 10¥)</h3>
<div class="outline-text-3" id="text-org1bf83d5">
<p>
Requirements
</p>
<ul class="org-ul">
<li><a href="https://salsa.debian.org/gnuk-team/gnuk/gnuk">gnuk source code</a></li>
<li>st-link v2(stm32) x2 or st-link v2 + j-link</li>
<li>Cross-compiling tools(pacman -S arm-none-eabi-gcc arm-none-eabi-newlib)</li>
<li>openocd (flash gnuk)</li>
<li>inetutils (telnet)</li>
</ul>
</div>
<div id="outline-container-org23f2515" class="outline-4">
<h4 id="org23f2515">Let me make</h4>
<div class="outline-text-4" id="text-org23f2515">
</div>
<ul class="org-ul">
<li><a id="org40774d7"></a>Compile gnuk<br>
<div class="outline-text-5" id="text-org40774d7">
<div class="org-src-container">
<pre class="src src-shell">git clone https://salsa.debian.org/gnuk-team/gnuk/gnuk.git
<span style="color: #705438; background-color: #E3EFD1; font-style: italic;">cd</span> gnuk/
git submodule update --init
<span style="color: #705438; background-color: #E3EFD1; font-style: italic;">cd</span> src/
./configure --vidpid=234b:0000 --target=ST_DONGLE
make build/gnuk-vidpid.bin
</pre>
</div>
</div>
</li>
<li><a id="org53d5ab7"></a>openocd.cfg<br>
<div class="outline-text-5" id="text-org53d5ab7">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;">#</span><span style="color: #758A99; font-style: italic; text-decoration: underline;">daemon configuration</span>
telnet_port 4444
gdb_port 3333

<span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;">#</span><span style="color: #758A99; font-style: italic; text-decoration: underline;">interface</span>
interface jlink
transport select swd

<span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;"># </span><span style="color: #758A99; font-style: italic; text-decoration: underline;">The chip has 64KB sram</span>
set WORKAREASIZE 0x10000

source [find target/stm32f1x.cfg]
<span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;">#</span><span style="color: #758A99; font-style: italic; text-decoration: underline;">adapter_khz 100</span>
gdb_breakpoint_override hard
</pre>
</div>
</div>
</li>
<li><a id="orge52ad67"></a>Flash Gnuk<br>
<div class="outline-text-5" id="text-orge52ad67">
<p>
Connecting the ST-LINK
</p>
<ul class="org-ul">
<li>SWDIO</li>
<li>GND</li>
<li>SWCLK</li>
<li>3.3v</li>
</ul>
<p>
Start openocd
</p>
<div class="org-src-container">
<pre class="src src-shell">openocd --file openocd.cfg
</pre>
</div>
<p>
telnet Gnuk
</p>
<div class="org-src-container">
<pre class="src src-shell">telnet 127.0.0.1 4444
</pre>
</div>
<p>
flash gnuk
</p>
<div class="org-src-container">
<pre class="src src-shell">stm32f1x unlock 0
reset halt
flash write_bank 0 ./src/build/gnuk-vidpid.bin 0
stm32f1x lock 0
reset halt
</pre>
</div>
<p>
Now you have 10¥ GPG Smart Card
</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1278a7f" class="outline-2">
<h2 id="org1278a7f">Git verified signature(eg. github)</h2>
<div class="outline-text-2" id="text-org1278a7f">
</div>
<div id="outline-container-org7f8d85b" class="outline-3">
<h3 id="org7f8d85b">Copy public key to github</h3>
<div class="outline-text-3" id="text-org7f8d85b">
<div class="org-src-container">
<pre class="src src-shell">gpg -a --export <span style="color: #ff8c00; font-weight: bold;">[</span>you key id<span style="color: #ff8c00; font-weight: bold;">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd98032d" class="outline-3">
<h3 id="orgd98032d">Config git use the key</h3>
<div class="outline-text-3" id="text-orgd98032d">
<div class="org-src-container">
<pre class="src src-shell">git config --global user.signingkey <span style="color: #ff8c00; font-weight: bold;">[</span>you key id<span style="color: #ff8c00; font-weight: bold;">]</span>
</pre>
</div>
<p>
if force gpg sign ?
</p>
<div class="org-src-container">
<pre class="src src-shell">git config --global commit.gpgsign true
</pre>
</div>
</div>
</div>
<div id="outline-container-org1e7040c" class="outline-3">
<h3 id="org1e7040c">Commit !</h3>
<div class="outline-text-3" id="text-org1e7040c">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #758A99; font-weight: bold; font-style: italic; text-decoration: underline;"># </span><span style="color: #758A99; font-style: italic; text-decoration: underline;">.gitconfig user.email need equal to gpg public key email</span>
git add .
git commit -m <span style="color: #177CB0;">"message"</span> -S
git push
</pre>
</div>
<p>
now your commit has verified(the green icon)
</p>
</div>
</div>
</div>
<div id="outline-container-org28eb76b" class="outline-2">
<h2 id="org28eb76b">References</h2>
<div class="outline-text-2" id="text-org28eb76b">
<ul class="org-ul">
<li><a href="https://www.yafa.moe/post/yubikey-guide/">Yubikey Guide</a></li>
<li><a href="https://kgame.tw/gnupg/stm32-gnuk/">ST-LINK V2 刷 Gnuk </a></li>
</ul>
</div>
</div>
<div class="taglist"><a href="https://keke-cute.github.io/tags.html">Tags</a>: <a href="https://keke-cute.github.io/tag-gpg.html">gpg</a> </div></div>
<div id="postamble" class="status"></div>
</body>
</html>
